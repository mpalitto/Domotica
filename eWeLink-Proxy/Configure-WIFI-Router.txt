sudo apt install isc-dhcp-server hostapd -y
sudo systemctl enable isc-dhcp-server
sudo systemctl unmask hostapd
sudo systemctl enable hostapd

# Configure HOSTAPD

Configure HOSTAPD as Access Poiont: `cat /etc/hostapd/hostapd.conf`

```
### Wireless network name ###
interface=wlxc4e9840b09a5
#Set operation mode (a = IEEE 802.11a, b = IEEE 802.11b, g = IEEE 802.11g)
hw_mode=g
#Set channel number (some driver will only use 0 as value)
channel=6
### (IN == INDIA, UK == United Kingdom, US == United Stats and so on ) ###
ieee80211d=1
country_code=IT
# QoS dupport
wmm_enabled=1
# test if this make it better
#disassoc_low_ack=1


### Set your bridge name ###
#bridge=br0
#driver=nl80211

#ssid=NathanielPI
ssid=testAP
## Shared Key Authentication ##
auth_algs=1
#Set wpa mode to 2:
wpa=2
#Set key and auth optionsmanagement for WPA2:
## Key management algorithms ##
wpa_key_mgmt=WPA-PSK
#wpa_pairwise=TKIP
rsn_pairwise=CCMP
#Set your passphrase (WiFi password):
#wpa_passphrase=PresaDellaBastiglia
wpa_passphrase=1234567890
## Accept all MAC address ###
# macaddr_acl=0
## Set cipher suites (encryption algorithms) ##
## TKIP = Temporal Key Integrity Protocol
## CCMP = AES in Counter mode with CBC-MAC
```

configure HOSTAPD interface: `cat /etc/default/isc-dhcp-server`
```
# Defaults for isc-dhcp-server (sourced by /etc/init.d/isc-dhcp-server)

# Path to dhcpd's config file (default: /etc/dhcp/dhcpd.conf).
DHCPDv4_CONF=/etc/dhcp/dhcpd.conf
#DHCPDv6_CONF=/etc/dhcp/dhcpd6.conf

# Path to dhcpd's PID file (default: /var/run/dhcpd.pid).
#DHCPDv4_PID=/var/run/dhcpd.pid
#DHCPDv6_PID=/var/run/dhcpd6.pid

# Additional options to start dhcpd with.
#       Don't use options -cf or -pf here; use DHCPD_CONF/ DHCPD_PID instead
#OPTIONS=""

# On what interfaces should the DHCP server (dhcpd) serve DHCP requests?
#       Separate multiple interfaces with spaces, e.g. "eth0 eth1".
INTERFACESv4="wlxc4e9840b09a5"
INTERFACESv6=""
```

assign IP-ADDR to WIFI interface: `ip addr add 192.168.200.1/24 brd + dev wlxc4e9840b09a5`

# Configure DHCP service: `cat /etc/dhcp/dhcpd.conf`

```
# This is a very basic subnet declaration.

subnet 192.168.200.0 netmask 255.255.255.0 {
  range 192.168.200.2 192.168.200.253;
  option subnet-mask 255.255.255.0;
  option broadcast-address 192.168.200.255;
  option routers 192.168.200.1;
  option domain-name-servers 192.168.1.1;
  authoritative;
}
```

start DHCP service: `service isc-dhcp-server start`

# ROUTING
```
# Accepting Incoming Traffic
iptables -A INPUT -j ACCEPT 
# Forwarding Traffic from eth0 to wlxc4e9840b09a5
iptables -A FORWARD -o wlxc4e9840b09a5 -j LOG --log-prefix "FilteredPacket: "
iptables -A FORWARD -i eth0 -o wlxc4e9840b09a5 -m state --state RELATED,ESTABLISHED -j ACCEPT
# Forwarding Traffic from wlxc4e9840b09a5 to eth0
iptables -A FORWARD -i wlxc4e9840b09a5 -j LOG --log-prefix "FilteredPacket: "
iptables -A FORWARD -i wlxc4e9840b09a5 -o eth0 -j ACCEPT
# Accepting Outgoing Traffic
iptables -A OUTPUT -j ACCEPT
# sets up Network Address Translation (NAT) for outgoing packets on the eth0
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```

for watching packets counts according to rules: `watch -n 1 'iptables -nvxL'`
same but for NAT table: `watch -n 1 'iptables -t nat -nvxL'`

It looks like the first few packets are coming and going through the INPUT and OUTPUT chain (probably for setgting up the web socket)
All the rest of the traffic goes through the FORWARD chain

# DEBUGGING tools: 
```
# capture all traffic to and from IP address
tcpdump --interface wlxc4e9840b09a5 -nn  host 192.168.200.1 -A 
# or... capture all traffic to and from PORT
tcpdump --interface wlxc4e9840b09a5 -nn  port 8081
# capture all traffic to and from PORT on eth0 interface
tcpdump --interface eth0 -nn  port 8081

```

NEXT STEP:
trying to duplicate packets coming from WiFi interface tcp Protocol port 8081
`iptables -t mangle -I POSTROUTING -p tcp --dport 8081 -j TEE --gateway 127.0.0.1`

and capture the packet content
`tcpdump --interface lo -nn -vv port 8081 -A`

look into the "connection.log" file